<!DOCTYPE html>
<html lang="zh">
<head>
    <title>分割数组使乘积互质</title>
    <link rel="shortcut icon" href="/static/favicon.ico">
    <link href="/static/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.bootcdn.net/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/detail.css">
    <link rel="stylesheet" href="/static/css/github.css">
    <style>
        body {
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        .container-fluid {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }
        main {
            flex-grow: 1;
        }
        .code-pre {
             white-space: pre-wrap;
             word-wrap: break-word;
        }
    </style>
</head>
<body>
    <div class="container-fluid mt-3">
        <header class="d-flex flex-column flex-md-row justify-content-md-between align-items-md-center mb-3">
            <a href="/problems" class="btn btn-secondary mb-2 mb-md-0">返回题目列表</a>
            <div class="text-md-end">
                <strong class="me-md-3 d-block d-md-inline mb-2 mb-md-0">分割数组使乘积互质</strong>
                标签:
                
                    <a href="/problems?tag=array" class="badge bg-secondary tag-link">数组</a>
                
                    <a href="/problems?tag=hash-table" class="badge bg-secondary tag-link">哈希表</a>
                
                    <a href="/problems?tag=math" class="badge bg-secondary tag-link">数学</a>
                
                    <a href="/problems?tag=number-theory" class="badge bg-secondary tag-link">数论</a>
                
                &nbsp;&nbsp;
                难度: <span class="badge bg-secondary">Hard</span>
            </div>
        </header>

        <main>
            <section class="mb-4">
                <h2>Submission</h2>
                <div class="code-block">
                    <pre class="bg-light p-2 code-pre"><code class="language-python">
ma = 10**6

def get_primes(M):
    f = [1]*M
    for i in range(2,isqrt(M)+1):
        if f[i]:
            f[i*i:M:i] = [0] * ((M-1-i*i)//i+1)
    return [i for i in range(2,M) if f[i]]

primes = get_primes(isqrt(ma)+1)

@cache
def factor(x):
    ct = Counter()
    for p in primes:
        while x%p==0:
            x//=p
            ct[p] += 1
    if x&gt;1:
        ct[x] += 1
    return ct

class Solution:
    def findValidSplit(self, nums: List[int]) -&gt; int:
        n = len(nums)
        d = {p:i for i in range(n) for p in factor(nums[i])}
        r = 0
        for i in range(n-1):
            for p in factor(nums[i]):
                r = max(r,d[p])
            if r==i:
                return i
        return -1
</code></pre>
                    <button class="btn btn-sm btn-secondary copy-btn" onclick="copyCode(this)">复制代码</button>
                    <p class="mt-2 mb-0">运行时间: 376 ms</p>
                    <p class="mb-0">内存: 48.3 MB</p>
                </div>
            </section>

            
                <section>
                    <h2>Explain</h2>
                    <div>
                        <p>本题解采用了一种基于数论和质因数分解的方法来寻找有效的分割点。首先，创建一个质数列表，用于对数组中的每个元素进行质因数分解。然后，利用一个字典记录每个质因数最后一次出现的位置。接着，遍历数组，对于每个元素，更新其质因数的最后出现位置，并检查当前位置是否是有效的分割点。如果当前位置与记录的最大质因数位置相等，说明该位置是一个有效的分割点，因为在此之前的所有元素的乘积与之后的元素的乘积不共享任何质因数，因而互质。如果遍历完成后没有找到有效分割点，则返回-1。</p>
                        <p>时间复杂度: O(n log M)</p>
                        <p>空间复杂度: O(n log M)</p>
                        
                             <pre class="bg-light p-2 code-pre"><code class="language-python">from math import isqrt
from functools import cache
from collections import Counter

# 计算不超过M的所有质数
ma = 10**6
def get_primes(M):
    f = [1]*M
    for i in range(2, isqrt(M)+1):
        if f[i]:
            f[i*i:M:i] = [0] * ((M-1-i*i)//i+1)
    return [i for i in range(2, M) if f[i]]

primes = get_primes(isqrt(ma)+1)

# 使用质数列表对x进行质因数分解
@cache
def factor(x):
    ct = Counter()
    for p in primes:
        while x % p == 0:
            x //= p
            ct[p] += 1
    if x &gt; 1:
        ct[x] += 1
    return ct

class Solution:
    def findValidSplit(self, nums: List[int]) -&gt; int:
        n = len(nums)
        # 记录每个质因数最后出现的位置
        d = {p: i for i in range(n) for p in factor(nums[i])}
        r = 0
        for i in range(n-1):
            # 更新质因数的最后位置
            for p in factor(nums[i]):
                r = max(r, d[p])
            # 检查当前位置是否为有效的分割点
            if r == i:
                return i
        return -1</code></pre>
                        
                    </div>
                </section>
            
        </main>
    </div>
    <script src="/static/js/jquery.min.js"></script>
    <script src="/static/js/bootstrap.bundle.min.js"></script>
    <script src="/static/js/highlight.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const copyButtons = document.querySelectorAll('.copy-btn');
            copyButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    copyCode(this);
                });
            });
            hljs.highlightAll();
        });

        function copyCode(button) {
            const codeBlock = button.previousElementSibling;
            const code = codeBlock.textContent;
            navigator.clipboard.writeText(code).then(function() {
                button.textContent = '已复制';
                setTimeout(function() {
                    button.textContent = '复制代码';
                }, 2000);
            }, function(err) {
                console.error('无法复制代码: ', err);
            });
        }
    </script>
</body>
</html>