<!DOCTYPE html>
<html lang="zh">
<head>
    <title>我的日程安排表 III</title>
    <link rel="shortcut icon" href="/static/favicon.ico">
    <link href="/static/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/detail.css">
    <link rel="stylesheet" href="/static/css/github.css">
    <style>
        body {
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        .container-fluid {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }
        main {
            flex-grow: 1;
        }
        .code-pre {
             white-space: pre-wrap;
             word-wrap: break-word;
        }
    </style>
</head>
<body>
    <div class="container-fluid mt-3">
        <header class="d-flex flex-column flex-md-row justify-content-md-between align-items-md-center mb-3">
            <a href="/problems" class="btn btn-secondary mb-2 mb-md-0">返回题目列表</a>
            <div class="text-md-end">
                <strong class="me-md-3 d-block d-md-inline mb-2 mb-md-0">我的日程安排表 III</strong>
                标签:
                
                    <a href="/problems?tag=design" class="badge bg-secondary tag-link">设计</a>
                
                    <a href="/problems?tag=segment-tree" class="badge bg-secondary tag-link">线段树</a>
                
                    <a href="/problems?tag=binary-search" class="badge bg-secondary tag-link">二分查找</a>
                
                    <a href="/problems?tag=ordered-set" class="badge bg-secondary tag-link">有序集合</a>
                
                &nbsp;&nbsp;
                难度: <span class="badge bg-secondary">Hard</span>
            </div>
        </header>

        <main>
            <section class="mb-4">
                <h2>Submission</h2>
                <div class="code-block">
                    <pre class="bg-light p-2 code-pre"><code class="language-python">from bisect import bisect_left

class MyCalendarThree:
    def __init__(self):
        self.s, self.e = [], []
        self.cap = 1
    def book(self, start: int, end: int) -&gt; int:
        ind1, ind2 = bisect_right(self.e, start), bisect_left(self.s, end)
        
        p1 = ind1
        curr = 1
        for st in range(ind1, ind2):
            
            if self.s[st]&lt;self.e[p1]: curr += 1
            else: p1 += 1
            self.cap = max(self.cap, curr)
        bisect.insort(self.s, start)
        bisect.insort(self.e, end)
        return self.cap
    &#39;&#39;&#39;def __init__(self):
        self.hmax, self.hs, self.marks=0, [], []

    def book(self, start: int, end: int) -&gt; int:

        i=bisect_left(self.marks, start)
        if i==len(self.marks) or self.marks[i]!=start:
            self.marks=self.marks[:i]+[start]+self.marks[i:]
            self.hs=self.hs[:i]+[self.hs[i-1] if i&gt;0 else 0]+self.hs[i:]
            
        j=bisect_left(self.marks, end)
        if j==len(self.marks) or self.marks[j]!=end:
            self.marks=self.marks[:j]+[end]+self.marks[j:]
            self.hs=self.hs[:j]+[self.hs[j-1]]+self.hs[j:]
    
        for k in range(i,j):
            self.hs[k]+=1
        hmax=max(self.hs[i:j])
        self.hmax=max(hmax,self.hmax)
        return self.hmax&#39;&#39;&#39;</code></pre>
                    <button class="btn btn-sm btn-secondary copy-btn" onclick="copyCode(this)">复制代码</button>
                    <p class="mt-2 mb-0">运行时间: 93 ms</p>
                    <p class="mb-0">内存: 16.5 MB</p>
                </div>
            </section>

            
                <section>
                    <h2>Explain</h2>
                    <div>
                        <p>这个题解使用了差分数组的思路。具体来说，它维护了两个有序数组 s 和 e，分别存储所有日程的开始时间和结束时间。当插入一个新的日程 [start, end) 时，它先通过二分查找找到 start 在 e 中的插入位置 ind1，以及 end 在 s 中的插入位置 ind2。然后从 ind1 开始遍历，用一个变量 curr 记录当前的预订次数，如果遇到一个日程的开始时间小于当前指针 p1 指向的日程的结束时间，说明发生了交叉，curr 就加 1。每次更新 curr 后都要更新答案 cap。最后再将 start 插入 s，将 end 插入 e。</p>
                        <p>时间复杂度: O(n)</p>
                        <p>空间复杂度: O(n)</p>
                        
                             <pre class="bg-light p-2 code-pre"><code class="language-python">from bisect import bisect_left, bisect_right

class MyCalendarThree:
    def __init__(self):
        self.s, self.e = [], []
        self.cap = 1

    def book(self, start: int, end: int) -&gt; int:
        # 找到 start 在 e 中的插入位置
        ind1 = bisect_right(self.e, start)
        # 找到 end 在 s 中的插入位置
        ind2 = bisect_left(self.s, end)
        
        p1 = ind1
        curr = 1
        for st in range(ind1, ind2):
            # 如果当前日程的开始时间小于指针 p1 指向的日程的结束时间，说明发生了交叉
            if self.s[st] &lt; self.e[p1]:
                curr += 1
            else:
                p1 += 1
            # 更新答案
            self.cap = max(self.cap, curr)
        # 将 start 插入 s
        bisect.insort(self.s, start)
        # 将 end 插入 e
        bisect.insort(self.e, end)
        return self.cap</code></pre>
                        
                    </div>
                </section>
            
        </main>
    </div>
    <script src="/static/js/jquery.min.js"></script>
    <script src="/static/js/bootstrap.bundle.min.js"></script>
    <script src="/static/js/highlight.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const copyButtons = document.querySelectorAll('.copy-btn');
            copyButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    copyCode(this);
                });
            });
            hljs.highlightAll();
        });

        function copyCode(button) {
            const codeBlock = button.previousElementSibling;
            const code = codeBlock.textContent;
            navigator.clipboard.writeText(code).then(function() {
                button.textContent = '已复制';
                setTimeout(function() {
                    button.textContent = '复制代码';
                }, 2000);
            }, function(err) {
                console.error('无法复制代码: ', err);
            });
        }
    </script>
</body>
</html>