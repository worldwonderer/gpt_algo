<!DOCTYPE html>
<html lang="zh">
<head>
    <title>每段建筑物的平均高度</title>
    <link rel="shortcut icon" href="/static/favicon.ico">
    <link href="/static/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/detail.css">
    <link rel="stylesheet" href="/static/css/github.css">
    <style>
        body {
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        .container-fluid {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }
        main {
            flex-grow: 1;
        }
        .code-pre {
             white-space: pre-wrap;
             word-wrap: break-word;
        }
    </style>
</head>
<body>
    <div class="container-fluid mt-3">
        <header class="d-flex flex-column flex-md-row justify-content-md-between align-items-md-center mb-3">
            <a href="/problems" class="btn btn-secondary mb-2 mb-md-0">返回题目列表</a>
            <div class="text-md-end">
                <strong class="me-md-3 d-block d-md-inline mb-2 mb-md-0">每段建筑物的平均高度</strong>
                标签:
                
                    <a href="/problems?tag=greedy" class="badge bg-secondary tag-link">贪心</a>
                
                    <a href="/problems?tag=array" class="badge bg-secondary tag-link">数组</a>
                
                    <a href="/problems?tag=sorting" class="badge bg-secondary tag-link">排序</a>
                
                    <a href="/problems?tag=heap-priority-queue" class="badge bg-secondary tag-link">堆（优先队列）</a>
                
                &nbsp;&nbsp;
                难度: <span class="badge bg-secondary">Medium</span>
            </div>
        </header>

        <main>
            <section class="mb-4">
                <h2>Submission</h2>
                <div class="code-block">
                    <pre class="bg-light p-2 code-pre"><code class="language-python">class Solution:
    def averageHeightOfBuildings(self, buildings: List[List[int]]) -&gt; List[List[int]]:
        diff = defaultdict(int)
        cnts = defaultdict(int)
        for a, b, h in buildings:
            diff[a] += h
            diff[b] -= h
            cnts[a] += 1
            cnts[b] -= 1
        cur, cnt, last, last_p, ans = 0, 0, None, None, []
        for k in sorted(diff.keys()):
            cur += diff[k]
            if last:
                if ans and ans[-1][1] == last_p and ans[-1][2] == last // cnt:
                    ans[-1][1] = k
                else:
                    ans.append([last_p, k, last // cnt])
            cnt += cnts[k]
            last, last_p = cur, k
        return ans
</code></pre>
                    <button class="btn btn-sm btn-secondary copy-btn" onclick="copyCode(this)">复制代码</button>
                    <p class="mt-2 mb-0">运行时间: 335 ms</p>
                    <p class="mb-0">内存: 86.5 MB</p>
                </div>
            </section>

            
                <section>
                    <h2>Explain</h2>
                    <div>
                        <p>The solution uses a line sweep algorithm combined with differential counting. For each building, start and end positions are marked in a &#39;diff&#39; dictionary where heights are added at the start and subtracted at the end. Another &#39;cnts&#39; dictionary tracks how many buildings start or end at each point. By iterating over the sorted keys of these dictionaries, we compute the current total height and count of buildings at each position. This allows us to determine the average height for any segment where it remains constant. The result is appended to the list if the average height changes from the previous segment or a new segment starts.</p>
                        <p>时间复杂度: O(k log k)</p>
                        <p>空间复杂度: O(k)</p>
                        
                             <pre class="bg-light p-2 code-pre"><code class="language-python">class Solution:
    def averageHeightOfBuildings(self, buildings: List[List[int]]) -&gt; List[List[int]]:
        diff = defaultdict(int)  # Differential map to track height changes at each point
        cnts = defaultdict(int)  # Count map to track number of buildings starting or ending
        for a, b, h in buildings:
            diff[a] += h  # Add height at the start of a building
            diff[b] -= h  # Subtract height at the end of a building
            cnts[a] += 1  # Increment building count at start
            cnts[b] -= 1  # Decrement building count at end
        cur, cnt, last, last_p, ans = 0, 0, None, None, []
        for k in sorted(diff.keys()):
            cur += diff[k]  # Update current total height
            if last:
                if ans and ans[-1][1] == last_p and ans[-1][2] == last // cnt:
                    ans[-1][1] = k  # Extend the last segment if average height is the same
                else:
                    ans.append([last_p, k, last // cnt])  # Start a new segment
            cnt += cnts[k]  # Update the count of overlapping buildings
            last, last_p = cur, k  # Store the current height and position for next iteration
        return ans</code></pre>
                        
                    </div>
                </section>
            
        </main>
    </div>
    <script src="/static/js/jquery.min.js"></script>
    <script src="/static/js/bootstrap.bundle.min.js"></script>
    <script src="/static/js/highlight.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const copyButtons = document.querySelectorAll('.copy-btn');
            copyButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    copyCode(this);
                });
            });
            hljs.highlightAll();
        });

        function copyCode(button) {
            const codeBlock = button.previousElementSibling;
            const code = codeBlock.textContent;
            navigator.clipboard.writeText(code).then(function() {
                button.textContent = '已复制';
                setTimeout(function() {
                    button.textContent = '复制代码';
                }, 2000);
            }, function(err) {
                console.error('无法复制代码: ', err);
            });
        }
    </script>
</body>
</html>